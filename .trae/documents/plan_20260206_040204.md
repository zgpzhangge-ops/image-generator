# Nano Banana 图生图 Web 应用重构计划

## 一、技术栈升级

| 层级 | 现有技术 | 目标技术 |
|------|---------|---------|
| 前端框架 | 原生 HTML/CSS/JS | React 18 + TypeScript |
| UI 组件库 | 原生 CSS | Shadcn UI + Tailwind CSS |
| 状态管理 | 原生变量 | React Hooks |
| 打包工具 | 无 | Vite 5 |

## 二、功能模块拆分

### 1. 核心组件 (src/components/)
```
src/components/
├── ApiKeyManager.tsx    # API Key 管理（输入、加密、校验、持久化）
├── ImageUploader.tsx    # 拖拽上传 + 预览 + Base64 转换
├── ControlPanel.tsx     # Prompt 输入框、重绘强度滑块、Seed 值
├── Gallery.tsx          # 瀑布流历史记录展示
├── SettingsModal.tsx    # 设置弹窗（整合 ApiKeyManager）
├── Header.tsx           # 应用顶部栏（含设置入口）
└── LoadingSpinner.tsx   # 统一 Loading 组件
```

### 2. 自定义 Hook (src/hooks/)
```
src/hooks/
├── useSillyDream.ts     # 核心 Hook：API Key 读取、请求状态、错误处理
└── useLocalStorage.ts  # 通用 localStorage 钩子
```

### 3. 类型定义 (src/types/)
```
src/types/
└── index.ts            # API 参数/响应类型定义
```

### 4. 服务层 (src/services/)
```
src/services/
└── api.ts              # API 请求封装（统一 Headers 注入）
```

## 三、UI/UX 设计规范

### 配色方案
- **主色调**: 紫色渐变 (#667eea → #764ba2) - 保持品牌一致性
- **背景**: 浅灰白 (#f8fafc)
- **卡片**: 纯白 (#ffffff) + 圆角 + 阴影
- **文字**: 深灰 (#1e293b) / 中灰 (#64748b)

### 布局结构
```
┌─────────────────────────────────────┐
│  Header (Logo + Settings 图标)      │
├─────────────────────────────────────┤
│                                     │
│  ┌─────────┐    ┌───────────────┐   │
│  │ 底图    │    │   参数控制     │   │
│  │ 上传区  │    │   Prompt      │   │
│  │         │    │   Denoising   │   │
│  └─────────┘    │   Seed        │   │
│                 └───────────────┘   │
│                                     │
│  ┌───────────────────────────────┐  │
│  │     生成按钮 (Loading)        │  │
│  └───────────────────────────────┘  │
│                                     │
│  ┌───────────────────────────────┐  │
│  │     Gallery (瀑布流历史)      │  │
│  └───────────────────────────────┘  │
│                                     │
└─────────────────────────────────────┘
```

## 四、核心功能实现要点

### 1. API Key 管理
- 使用 `useLocalStorage` Hook 持久化存储
- Input 框 `type="password"` 实现密码隐藏
- 生成前 `useSillyDream` Hook 自动校验 Key
- Key 为空时禁用生成按钮并提示
- 清除缓存按钮一键删除 localStorage

### 2. 请求头注入
```typescript
// api.ts
const getHeaders = () => {
  const apiKey = localStorage.getItem('sillydream_api_key');
  return {
    'Authorization': `Bearer ${apiKey}`,
    'Content-Type': 'application/json'
  };
};
```

### 3. 进度反馈
- 生成按钮实时 Loading 动画
- 建议使用 Shadcn UI Progress 组件
- 添加趣味文案（如 "Nano banana 正在发挥创意..."）

### 4. 历史记录
- 存储在 Session（刷新不丢失）或 localStorage
- 瀑布流布局（Masonry）展示缩略图
- 点击可查看大图或重新生成

## 五、文件结构

```
插画裂变/
├── src/
│   ├── main.tsx           # 入口文件
│   ├── App.tsx            # 主应用组件
│   ├── index.css          # 全局样式
│   ├── components/        # 组件
│   ├── hooks/            # 自定义 Hook
│   ├── services/         # API 服务
│   └── types/            # 类型定义
├── index.html            # HTML 入口
├── package.json          # 依赖配置
├── vite.config.ts        # Vite 配置
├── tailwind.config.js    # Tailwind 配置
└── tsconfig.json         # TypeScript 配置
```

## 六、开发步骤

### 阶段一：项目初始化
1. 创建 Vite + React + TypeScript 项目
2. 配置 Tailwind CSS
3. 安装 Shadcn UI 依赖

### 阶段二：基础组件
1. 实现 useLocalStorage Hook
2. 创建 ImageUploader 组件
3. 创建 ControlPanel 组件

### 阶段三：核心逻辑
1. 实现 useSillyDream Hook
2. 创建 ApiKeyManager 组件
3. 创建 SettingsModal 组件

### 阶段四：UI 完善
1. 创建 Header 组件
2. 创建 Gallery 组件
3. 整合 App.tsx

### 阶段五：测试验证
1. 本地运行测试
2. 验证 API Key 持久化
3. 测试图生图完整流程

## 七、后端兼容

后端 `app.py` **无需修改**，保持现有逻辑。

前端将直接调用 `http://localhost:3000/api/gen_image` 接口。

---

**确认后开始执行：创建项目结构并逐步实现所有功能模块。**